<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="description" content="blog about music" />
  <meta name="author" content="tianwenh">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/svg+xml" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAt9JREFUWEftV01IYmEUPZ+EiwgiWoiLoCct0wqEqIiCoLICRQg3/VC0mmgTQTXOZDkktGhRkJTSjxW4qKhVFJlCRKsWtShoU5ua2QRKirapF/dCMeYIMfFy44W3efreOd+5557vfQKASpKk7wC+CSG0+IKSZfkPAPfNzY1LSJL0Qwjx6wtwUyBkWf5JBH5/1crfMyAlhE6nkzOx+lfMLIGsAikKmEwm2Gw27Ozs8EU1NDSE0tLSD3k1Go1iYGAAXq8XKpUKfX19kOX0Pk8hQA+Mjo5iZmYGs7OzDLqwsICqqqokArm5uRBCIB6PJwFcXV2hvb0dgUAAkiShsrIS9/f3acl/iMC/nj4+PoZWq0V5eTlo1e9rcXER9fX1sFqtOD8/55/Hx8fR2tqKcDiMxsZGvqcYgbGxMXR3d3M7dnd3GWxra4sJU1VUVODh4UE5Al1dXXA4HJiamoLH42HQs7MzRCIRFBUVvSmjmAJ1dXVYWlrC+vo6E9FoNDg5OcHy8jJ6enrY2Nvb2xAmkynJotQzMuLfJvwfDxQXF+Pw8BChUIjfV1NTg9XVVXR2dmJtbQ1utxvT09MQcpoZ+SyBnJwcXF5e4vr6Gs3NzaCWkC/KysoQDAZxenqK/v5+CIfDkaRAdXU1O/SzBEg1Wn1hYSEMBgOcTicaGhpYCb/fj/z8fLS0tChnQiKwsrKC2tpaGI1GzM3N4enpiVvgcrlgsVg43BQzIRGYmJhAR0cHzGYzKBf29vbYkK9hRzmhKIHe3l7Y7Xa+JicnuQ0+n49bQaM5PDysLIFXoP39fTQ1NfH4HR0dcURTVJMiiipQUlICAo/FYsjLywNlw+3tLWhCLi4ukEgklCWgVqsZiHbFx8dH6PV6PD8/c6wcHBxAp9OlEmhra2OnbmxsYHNzM+0uRkFCI0ay0o6Yrubn51FQUIC7uzsMDg6+/W1kZIT3g+wXUVaBzCuQ8aNZxg+nmT6evwD1qc7gHFaxDAAAAABJRU5ErkJggg==" />
  <title>HTW</title>
  <script type="module" crossorigin src="/assets/index.f50c697a.js"></script>
  <link rel="stylesheet" href="/assets/index.2e98ca4e.css">
</head>

<body>
  <div id="app">
    <div class="layout-container"><header class="layout-head"><h3><a href="/">HTW</a><span class="dark-toggle">ðŸŒ”</span></h3></header><main><header><h2 class="page-title"><a href="/how-this-blog-is-built">How this blog is built</a></h2><p class="page-subtitle">Yet another static site generator built in 2022.</p><small><time dateTime="1/8/2022" class="page-info">1/8/2022</time></small></header><hr/><blockquote>
<p>Check out <a target="_blank" href="https://github.com/tianwenh/tianwenh.github.io">github</a> for source code.</p>
</blockquote>
<p>Instead of learning all the exsiting static site generators, I decided to start 2022 by building my own.</p>
<h2 id="what-are-the-options"><a class="header-anchor" href="#what-are-the-options">#</a>What are the options?</h2>
<p>There are several options building your own blog:</p>
<ol start="0">
<li>Write your own SSG from scratch;</li>
<li>Use existing SSG (static site generator) + theme;</li>
<li>Use existing SSG + custom theme;</li>
</ol>
<p>The time needed for learning/hacking existing theme and SSG is probably similar to writing your own. Even if not, knowing all the details at the very beginning will probably compensate the costs later on.</p>
<h2 id="static-site-generator-breakdown"><a class="header-anchor" href="#static-site-generator-breakdown">#</a>Static site generator breakdown</h2>
<p>Break down features that I need:</p>
<ul>
<li>Light weight dev experience;</li>
<li>MDX and plugin customization;</li>
<li>Frontmatter extraction;</li>
<li>SSR support;</li>
<li>Deploy automation;</li>
<li>Dark mode;</li>
<li>Custom theming;</li>
</ul>
<h2 id="lightweight-dev-experience"><a class="header-anchor" href="#lightweight-dev-experience">#</a>Lightweight dev experience</h2>
<p>I am not working for a billion dollar project. <a target="_blank" href="https://vitejs.dev/">Vite</a> comes in handy for what I expectes. Fast load, SSR support, extensible, reasonable defaults, etc.</p>
<p>Starting the project with its official <a target="_blank" href="https://vitejs.dev/guide/#trying-vite-online">react-ts template</a>, just a few clicks, website is up running.</p>
<p>Other general setups (eslint, prettier) are omitted here, but you can find resources online or copy <a target="_blank" href="https://github.com/tianwenh/vite-template">my template</a>.</p>
<p>This paves way for all the later works, enables customization and so on.</p>
<h2 id="mdx-and-customization"><a class="header-anchor" href="#mdx-and-customization">#</a>MDX and customization</h2>
<p>The next big piece is MDX support. Mostly, follow <a target="_blank" href="https://mdxjs.com/">mdxjs</a> tutorial.</p>
<p>Once MDX plugin is installed, it is time for more MDX plugins:</p>
<ul>
<li><code>remark-gfm</code> for better markdown rendering;</li>
<li><code>remark-frontmatter</code> for extracting frontmatter;</li>
<li><code>remark-math</code>, <code>rehype-katex</code> for math latex rendering;</li>
<li><code>mdx-prism</code> for code highlighting and line highlighting;</li>
<li><code>rehype-slug</code>, <code>rehype-autolink-headings</code> for linkify headings;</li>
</ul>
<p>Just follow github repo tutoirals, install and add to <code>vite.config.ts</code>. I also assembled them together to save you some research:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> mdx <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;@tianwenh/vite-plugin-ssgpage&#x27;</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="music-notation"><a class="header-anchor" href="#music-notation">#</a>Music notation</h3>
<p>For music notation rendering, I ended up with building <code>Vexflow</code> React components and calling them from mdx. Considered <code>lilypond</code>, it seems to be too heavy for my usage.</p>
<h3 id="override-mdx-component-rendering"><a class="header-anchor" href="#override-mdx-component-rendering">#</a>Override MDX component rendering</h3>
<p>I also customized my own <code>MdxLink</code> so that:</p>
<ul>
<li>Links always jump to new pages;</li>
<li>Extensions are dropped for correct deeplink routing;</li>
</ul>
<h2 id="frontmatter"><a class="header-anchor" href="#frontmatter">#</a>Frontmatter</h2>
<p>Frontmatter is metadata at the beginning of the markdown file. There are 4 main properties I defined:</p>
<ul>
<li>title: UUID for each post;</li>
<li>date: when is post wrote;</li>
<li>subtitle: a sneak peek of post;</li>
<li>tags: used for grouping posts;</li>
</ul>
<p>This is a pretty standard way of organizing blog posts.</p>
<h2 id="grab-pages"><a class="header-anchor" href="#grab-pages">#</a>Grab pages</h2>
<p>SSG is pages (similar to config) driven. Pages are essentailly all the md/mdx files.</p>
<p>I wrote a <code>pages</code> vite plugin, which auto grabs pages from certain folders, parse then rendering them in my custom theme.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> pages <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;@tianwenh/vite-plugin-ssgpage&#x27;</span><span class="token punctuation">;</span>
</code></pre>
<p>At higher level, it works this way:</p>
<ol>
<li><code>/pages</code> folder serves all static md/mdx files;</li>
<li><code>pages</code> plugin grabs these files, transforms and groups them under <code>@pages</code> virtual plugin;</li>
<li>Theme TS files import metadata from <code>@pages</code>, vite will resolve to metadata file at build time;</li>
<li>Runtime rendering retrives metadata and convert them into pages/tags under different routes;</li>
</ol>
<h2 id="custom-theming"><a class="header-anchor" href="#custom-theming">#</a>Custom theming</h2>
<p>As you can tell, my theme is pretty minimal. I took design inspiration from <a target="_blank" href="https://overreacted.io">overreacted.io</a>. Just tweak around css to make it not ugly...</p>
<p>It supports dark mode as well, which auto detects user system preference, and persists user setting in local storage.</p>
<h2 id="ssr"><a class="header-anchor" href="#ssr">#</a>SSR</h2>
<p>To begin with SSR, follow the vite tutorial. I did some modification, and put together another plugin to fit in my use case:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> ssr <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;@tianwenh/vite-plugin-ssgpage&#x27;</span><span class="token punctuation">;</span>
</code></pre>
<p>Once installed, it preloads all linkable pages with a BFS search from provided entry html.</p>
<h2 id="deploy-automation"><a class="header-anchor" href="#deploy-automation">#</a>Deploy automation</h2>
<p>For deployment, <code>gh-pages</code> is used for manual push. I also created a <a target="_blank" href="https://github.com/tianwenh/tianwenh.github.io/blob/main/.github/workflows/deploy.yml">github action</a> that auto builds and deploys the latest <code>main</code> branch push to <code>gh-pages</code>.</p>
<h2 id="how-to-use"><a class="header-anchor" href="#how-to-use">#</a>How to use</h2>
<p>I abstracted everything generic into <a target="_blank" href="https://github.com/tianwenh/vite-plugin-ssgpage">plugins</a>. Read <a target="_blank" href="https://github.com/tianwenh/vite-plugin-ssgpage/tree/main/examples/blog">my example README</a> for detailed instructions.</p>
<p>For writing posts, just add new pages, and <code>git push</code>.</p>
<h2 id="future-plans"><a class="header-anchor" href="#future-plans">#</a>Future plans</h2>
<p>Develop the idea to:</p>
<ul>
<li>Serving docs for projects;</li>
<li>Jupyter Notebook-ish interactive playground for personal code study;</li>
<li>Foam/roam research-ish rendering;</li>
</ul>
<h2 id="conclusion"><a class="header-anchor" href="#conclusion">#</a>Conclusion</h2>
<p>I said it easy, it in fact does require a few weeks to build up a plan, research best practices, tweak around css/js, and debugging.</p>
<p>Finally, <a target="_blank" href="https://github.com/tianwenh/tianwenh.github.io">website source code</a> is here.</p><hr/><footer>EOF</footer></main></div>
  </div>
  
</body>

</html>