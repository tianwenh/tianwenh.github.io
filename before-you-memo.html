<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAt9JREFUWEftV01IYmEUPZ+EiwgiWoiLoCct0wqEqIiCoLICRQg3/VC0mmgTQTXOZDkktGhRkJTSjxW4qKhVFJlCRKsWtShoU5ua2QRKirapF/dCMeYIMfFy44W3efreOd+5557vfQKASpKk7wC+CSG0+IKSZfkPAPfNzY1LSJL0Qwjx6wtwUyBkWf5JBH5/1crfMyAlhE6nkzOx+lfMLIGsAikKmEwm2Gw27Ozs8EU1NDSE0tLSD3k1Go1iYGAAXq8XKpUKfX19kOX0Pk8hQA+Mjo5iZmYGs7OzDLqwsICqqqokArm5uRBCIB6PJwFcXV2hvb0dgUAAkiShsrIS9/f3acl/iMC/nj4+PoZWq0V5eTlo1e9rcXER9fX1sFqtOD8/55/Hx8fR2tqKcDiMxsZGvqcYgbGxMXR3d3M7dnd3GWxra4sJU1VUVODh4UE5Al1dXXA4HJiamoLH42HQs7MzRCIRFBUVvSmjmAJ1dXVYWlrC+vo6E9FoNDg5OcHy8jJ6enrY2Nvb2xAmkynJotQzMuLfJvwfDxQXF+Pw8BChUIjfV1NTg9XVVXR2dmJtbQ1utxvT09MQcpoZ+SyBnJwcXF5e4vr6Gs3NzaCWkC/KysoQDAZxenqK/v5+CIfDkaRAdXU1O/SzBEg1Wn1hYSEMBgOcTicaGhpYCb/fj/z8fLS0tChnQiKwsrKC2tpaGI1GzM3N4enpiVvgcrlgsVg43BQzIRGYmJhAR0cHzGYzKBf29vbYkK9hRzmhKIHe3l7Y7Xa+JicnuQ0+n49bQaM5PDysLIFXoP39fTQ1NfH4HR0dcURTVJMiiipQUlICAo/FYsjLywNlw+3tLWhCLi4ukEgklCWgVqsZiHbFx8dH6PV6PD8/c6wcHBxAp9OlEmhra2OnbmxsYHNzM+0uRkFCI0ay0o6Yrubn51FQUIC7uzsMDg6+/W1kZIT3g+wXUVaBzCuQ8aNZxg+nmT6evwD1qc7gHFaxDAAAAABJRU5ErkJggg==" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HTW</title>
  <script type="module" crossorigin src="/assets/index.bb22a6a5.js"></script>
  <link rel="modulepreload" href="/assets/vendor.08379ce7.js">
  <link rel="stylesheet" href="/assets/index.8e7d09d6.css">
</head>

<body>
  <div id="app">
    <div class="layout-container"><header class="layout-head"><h3><a href="/">HTW</a><span class="dark-toggle">ðŸŒ”</span></h3></header><main><header><h2 class="page-title"><a href="/before-you-memo">Before You memo()</a></h2><p class="page-subtitle">Rendering optimizations that come naturally.</p><small><time dateTime="2/22/2021" class="page-info">2/22/2021</time><a class="page-info" href="/tags/react">#<!-- -->react</a><a class="page-info" href="/tags/js">#<!-- -->js</a><a class="page-info" href="/tags/test">#<!-- -->test</a><a class="page-info" href="/tags/tech">#<!-- -->tech</a><a class="page-info" href="/tags/game">#<!-- -->game</a><a class="page-info" href="/tags/design">#<!-- -->design</a><a class="page-info" href="/tags/ux">#<!-- -->ux</a><a class="page-info" href="/tags/hello">#<!-- -->hello</a><a class="page-info" href="/tags/macbook">#<!-- -->macbook</a><a class="page-info" href="/tags/mouse">#<!-- -->mouse</a></small></header><hr/><p>There are many articles written about React performance optimizations. In general, if some state update is slow, you need to:</p>
<ol>
<li>Verify you&#x27;re running a production build. (Development builds are intentionally slower, in extreme cases even by an order of magnitude.)</li>
<li>Verify that you didn&#x27;t put the state higher in the tree than necessary. (For example, putting input state in a centralized store might not be the best idea.)</li>
<li>Run React DevTools Profiler to see what gets re-rendered, and wrap the most expensive subtrees with <code>memo()</code>. (And add <code>useMemo()</code> where needed.)</li>
</ol>
<p>This last step is annoying, especially for components in between, and ideally a compiler would do it for you. In the future, it might.</p>
<p><strong>In this post, I want to share two different techniques.</strong> They&#x27;re surprisingly basic, which is why people rarely realize they improve rendering performance.</p>
<p><strong>These techniques are complementary to what you already know!</strong> They don&#x27;t replace <code>memo</code> or <code>useMemo</code>, but they&#x27;re often good to try first.</p>
<h2 id="an-artificially-slow-component"><a class="header-anchor" href="/before-you-memo#an-artificially-slow-component">#</a>An (Artificially) Slow Component</h2>
<p>Here&#x27;s a component with a severe rendering performance problem:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;red&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello, world!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ExpensiveTree</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ExpensiveTree</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span><span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> now <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Artificial delay -- do nothing for 100ms</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">I am a very slow component tree.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><em>(<a target="_blank" href="https://codesandbox.io/s/frosty-glade-m33km?file=/src/App.js:23-513">Try it here</a>)</em></p>
<p>The problem is that whenever <code>color</code> changes inside <code>App</code>, we will re-render <code>&lt;ExpensiveTree /&gt;</code> which we&#x27;ve artificially delayed to be very slow.</p>
<p>I could <a target="_blank" href="https://codesandbox.io/s/amazing-shtern-61tu4?file=/src/App.js">put <code>memo()</code> on it</a> and call it a day, but there are many existing articles about it so I won&#x27;t spend time on it. I want to show two different solutions.</p>
<h2 id="solution-1-move-state-down"><a class="header-anchor" href="/before-you-memo#solution-1-move-state-down">#</a>Solution 1: Move State Down</h2>
<p>If you look at the rendering code closer, you&#x27;ll notice only a part of the returned tree actually cares about the current <code>color</code>:</p>
<pre class="language-jsx"><code class="language-jsx{2,5-6}"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<div class="mdx-marker">  <span class="token keyword">let</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;red&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</div>  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
<!-- -->    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<div class="mdx-marker"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
</div><div class="mdx-marker"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello, world!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
</div><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ExpensiveTree</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<!-- -->  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So let&#x27;s extract that part into a <code>Form</code> component and move state <em>down</em> into it:</p>
<pre class="language-jsx"><code class="language-jsx{4,11,14,15}"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!-- -->  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
<!-- -->    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<div class="mdx-marker"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
</div><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ExpensiveTree</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
<!-- -->  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<!-- -->
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<div class="mdx-marker">  <span class="token keyword">let</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;red&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</div>  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
<!-- -->    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<div class="mdx-marker"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
</div><div class="mdx-marker"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello, world!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
</div><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
<!-- -->  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><em>(<a target="_blank" href="https://codesandbox.io/s/billowing-wood-1tq2u?file=/src/App.js:64-380">Try it here</a>)</em></p>
<p>Now if the <code>color</code> changes, only the <code>Form</code> re-renders. Problem solved.</p>
<h2 id="solution-2-lift-content-up"><a class="header-anchor" href="/before-you-memo#solution-2-lift-content-up">#</a>Solution 2: Lift Content Up</h2>
<p>The above solution doesn&#x27;t work if the piece of state is used somewhere <em>above</em> the expensive tree. For example, let&#x27;s say we put the <code>color</code> on the <em>parent</em> <code>&lt;div&gt;</code>:</p>
<pre class="language-jsx"><code class="language-jsx{2,4}"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<div class="mdx-marker">  <span class="token keyword">let</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;red&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</div>  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
<div class="mdx-marker">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
</div><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello, world!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ExpensiveTree</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<!-- -->  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><em>(<a target="_blank" href="https://codesandbox.io/s/bold-dust-0jbg7?file=/src/App.js:58-313">Try it here</a>)</em></p>
<p>Now it seems like we can&#x27;t just &quot;extract&quot; the parts that don&#x27;t use <code>color</code> into another component, since that would include the parent <code>&lt;div&gt;</code>, which would then include <code>&lt;ExpensiveTree /&gt;</code>. Can&#x27;t avoid <code>memo</code> this time, right?</p>
<p>Or can we?</p>
<p>Play with this sandbox and see if you can figure it out.</p>
<p>...</p>
<p>...</p>
<p>...</p>
<p>The answer is remarkably plain:</p>
<pre class="language-jsx"><code class="language-jsx{4,5,10,15}"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!-- -->  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
<!-- -->    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ColorPicker</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<div class="mdx-marker"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello, world!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
</div><div class="mdx-marker"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ExpensiveTree</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
</div><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ColorPicker</span></span><span class="token punctuation">&gt;</span></span>
<!-- -->  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<!-- -->
<div class="mdx-marker"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ColorPicker</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</div>  <span class="token keyword">let</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!-- -->  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
<!-- -->    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"></span>
<div class="mdx-marker"><span class="token plain-text">      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
</div><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<!-- -->  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><em>(<a target="_blank" href="https://codesandbox.io/s/wonderful-banach-tyfr1?file=/src/App.js:58-423">Try it here</a>)</em></p>
<p>We split the <code>App</code> component in two. The parts that depend on the <code>color</code>, together with the <code>color</code> state variable itself, have moved into <code>ColorPicker</code>.</p>
<p>The parts that don&#x27;t care about the <code>color</code> stayed in the <code>App</code> component and are passed to <code>ColorPicker</code> as JSX content, also known as the <code>children</code> prop.</p>
<p>When the <code>color</code> changes, <code>ColorPicker</code> re-renders. But it still has the same <code>children</code> prop it got from the <code>App</code> last time, so React doesn&#x27;t visit that subtree.</p>
<p>And as a result, <code>&lt;ExpensiveTree /&gt;</code> doesn&#x27;t re-render.</p>
<h2 id="whats-the-moral"><a class="header-anchor" href="/before-you-memo#whats-the-moral">#</a>What&#x27;s the moral?</h2>
<p>Before you apply optimizations like <code>memo</code> or <code>useMemo</code>, it might make sense to look if you can split the parts that change from the parts that don&#x27;t change.</p>
<p>The interesting part about these approaches is that <strong>they don&#x27;t really have anything to do with performance, per se</strong>. Using the <code>children</code> prop to split up components usually makes the data flow of your application easier to follow and reduces the number of props plumbed down through the tree. Improved performance in cases like this is a cherry on top, not the end goal.</p>
<p>Curiously, this pattern also unlocks <em>more</em> performance benefits in the future.</p>
<p>For example, when <a target="_blank" href="https://reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html">Server Components</a> are stable and ready for adoption, our <code>ColorPicker</code> component could receive its <code>children</code> <a target="_blank" href="https://youtu.be/TQQPAU21ZUw?t=1314">from the server</a>. Either the whole <code>&lt;ExpensiveTree /&gt;</code> component or its parts could run on the server, and even a top-level React state update would &quot;skip over&quot; those parts on the client.</p>
<p>That&#x27;s something even <code>memo</code> couldn&#x27;t do! But again, both approaches are complementary. Don&#x27;t neglect moving state down (and lifting content up!)</p>
<p>Then, where it&#x27;s not enough, use the Profiler and sprinkle those memoâ€™s.</p>
<h2 id="didnt-i-read-about-this-before"><a class="header-anchor" href="/before-you-memo#didnt-i-read-about-this-before">#</a>Didn&#x27;t I read about this before?</h2>
<p><a target="_blank" href="https://kentcdodds.com/blog/optimize-react-re-renders">Yes, probably.</a></p>
<p>This is not a new idea. It&#x27;s a natural consequence of React composition model. It&#x27;s simple enough that it&#x27;s underappreciated, and deserves a bit more love.</p><hr/><footer>EOF</footer></main></div>
  </div>
  
</body>

</html>